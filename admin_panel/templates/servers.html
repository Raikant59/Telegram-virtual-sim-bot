{% extends "base.html" %}
{% block title %}Manage Servers{% endblock %}
{% block content %}
<style>
  header{background:linear-gradient(135deg,#9b59b6,#8e44ad);color:#fff;padding:20px;text-align:center;}
  main{max-width:900px;margin:auto;padding:20px;}
  .card{background:#fff;border-radius:15px;padding:20px;margin-bottom:20px;box-shadow:0 4px 10px rgba(0,0,0,0.08);}
  label{font-weight:600;display:block;margin:10px 0 6px;}
  input,select{width:100%;padding:10px;border:1px solid #ccc;border-radius:10px;}
  button{background:#8e44ad;color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:600;}
  button:hover{opacity:.95}
  ul{list-style:none;padding:0;margin:0}
  li{display:flex;gap:12px;justify-content:space-between;align-items:center;background:#f9fafb;border-radius:10px;padding:12px;margin-bottom:10px;flex-wrap:wrap;}
  .row-actions{display:flex;gap:8px}
  .delete-btn{background:#e74c3c;padding:8px 12px;border:none;border-radius:8px;color:#fff;}
  .edit-btn{background:#3498db;padding:8px 12px;border:none;border-radius:8px;color:#fff;}
  @media(max-width:640px){ li{flex-direction:column; align-items:flex-start;} .row-actions{align-self:flex-end;} }
  .modal{display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:999; align-items:center; justify-content:center;max-height: 90vh;      /* don't exceed 90% of viewport height */
  overflow-y: auto;      /* enable vertical scroll inside */
}
  .modal-content{background:#fff; width:92%; max-width:480px; padding:20px; border-radius:12px; position:relative;}
  .close{position:absolute; right:12px; top:10px; font-size:20px; cursor:pointer;}
</style>

<header><h1>üåê Manage Servers</h1></header>
<main>
  <div class="card">
    <h2>‚ûï Add Server</h2>
    <form method="POST">
      <input type="hidden" name="action" value="add">
      <label>Name</label>
      <input type="text" name="name" required>
      <label>Country</label>
      <select name="country" required>
        {% for c, flag in countries %}
          <option value="{{ flag }} {{ c }}" {% if c == "India" %}selected{% endif %}>{{ flag }} {{ c }}</option>
        {% endfor %}
      </select>
      <button type="submit"><i class="fa-solid fa-save"></i> Save Server</button>
    </form>
  </div>

  <div class="card">
    <h2>üìã Current Servers</h2>
    <ul>
      {% for s in servers %}
      <li>
        <div><b>{{ s.name }}</b> <small>({{ s.country }})</small></div>
        <div class="row-actions">
          <button class="edit-btn" onclick="openEdit('{{ s.id }}','{{ s.name|e }}','{{ s.country|e }}')"><i class="fa-solid fa-pen"></i></button>
          <form method="POST">
            <input type="hidden" name="action" value="delete">
            <input type="hidden" name="server_id" value="{{ s.id }}">
            <button type="submit" class="delete-btn"><i class="fa-solid fa-trash"></i></button>
          </form>
        </div>
      </li>
      {% endfor %}
    </ul>
  </div>
</main>

<div class="modal" id="editModal">
  <div class="modal-content">
    <span class="close" onclick="closeEdit()">&times;</span>
    <h2>‚úèÔ∏è Edit Server</h2>
    <form method="POST">
      <input type="hidden" name="action" value="edit">
      <input type="hidden" name="server_id" id="e_server_id">
      <label>Name</label>
      <input type="text" name="name" id="e_name" required>
      <label>Country</label>
      <select name="country" id="e_country" required>
        {% for c, flag in countries %}
          <option value="{{ flag }} {{ c }}">{{ flag }} {{ c }}</option>
        {% endfor %}
      </select>
      <button type="submit"><i class="fa-solid fa-save"></i> Update</button>
    </form>
  </div>
</div>

<script>
  function openEdit(id, name, country){
    document.getElementById('e_server_id').value = id;
    document.getElementById('e_name').value = name;
    document.getElementById('e_country').value = country;
    document.getElementById('editModal').style.display = 'flex';
  }
  function closeEdit(){ document.getElementById('editModal').style.display='none'; }
  window.addEventListener('click', (e)=>{ if(e.target===document.getElementById('editModal')) closeEdit(); });
</script>
{% endblock %}
